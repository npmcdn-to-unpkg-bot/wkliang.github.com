<!DOCTYPE HTML>
<html>
<head>
<meta name="description" content="pg#714, Example 22-16. A WebSocket-based chat client"/>
<title>A WebSocket-based chat client</title>
<script>
window.onload = function() {
    // Take care of some UI details
    var nick = prompt("Enter your nickname");		// Get user's nickname
    var input = document.getElementById("input");	// Find the input field
    input.focus();					// Set keyboard focus

    // Open a WebSocket to send and receive chat messages on.
    // Assume that the HTTP server we were downloaded from also functions as
    // a websocket server, and use the same host name and port, but change
    // from the http:// protocol to ws://
    // var socket = new WebSocket("ws://" + location.host + "/");
    var socket = new WebSocket("ws://www.dcon.at:8003/test/websockets/ns_chan");

    socket.onopen = function(event) {
	console.log("onopen","connected");
    };
    socket.onerror = function(event) {
	console.log("onerror", event.data);
    };
    socket.onclose = function(event) {
	console.log("onclse","disconnected");
    };

    // This is how we receive messages from the server through the web socket
    socket.onmessage = function(event) {	// When a new message arrives
	var msg = event.data;			// Get text from event object
	var node = document.createTextNode(msg); // Make it into a text node
	var div = document.createElement("div"); // Create a <div>
	div.appendChild(node);			 // Add text node to div
	document.body.insertBefore(div,input);	 // And add div before input
	input.scrollIntoView();			 // Ensure input elt is visible
    };

    // This is how we send messages to the server through the web socket
    input.onchange = function() {		// When user strikes return
	var msg = nick + ": " + input.value;	// Username plus user's input
	socket.send(msg);			// Send it through the socket
	input.value = "";			// Get ready for more input
    };

}
</script>
</head>
<body>
<!-- The chat UI is just a single, wide text input field -->
<!-- New chat messages will be inserted before this element -->
<input id="input" style="width:100%"/>
</body>
</html>
